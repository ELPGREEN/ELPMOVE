<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Embarque em uma jornada espacial com a Nave Invest e receba orientações personalizadas para seus investimentos!">
    <meta name="keywords" content="investimentos, IA, Grok 3, nave espacial, finanças, pagamento">
    <meta name="author" content="Nave Invest">
    <meta name="robots" content="index, follow">
    <title>Nave Invest - Jornada Espacial de Investimentos</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;600&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            background: #0a0a23;
            color: #fff;
            overflow: hidden;
        }
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }
        .interface {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #chat-container {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            width: 400px;
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        #chat-messages {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        #chat-messages p {
            margin: 5px 0;
            font-size: 1rem;
        }
        #chat-messages .user {
            color: #00ffcc;
        }
        #chat-messages .grok {
            color: #ff00ff;
        }
        #chat-input {
            width: 100%;
            padding: 10px;
            background: #1a1a33;
            border: none;
            color: #fff;
            border-radius: 5px;
        }
        #send-btn {
            margin-top: 10px;
            padding: 10px 20px;
            background: linear-gradient(90deg, #ff00ff, #00ffcc);
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
        }
        #galaxy-section {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 3;
            background: linear-gradient(135deg, rgba(10, 10, 35, 0.95), rgba(0, 0, 0, 0.95));
            padding: 60px;
            overflow-y: auto;
        }
        .galaxy-content {
            min-height: 200vh;
            padding-bottom: 100px;
        }
        #galaxy-section h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            color: #00ffcc;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }
        #galaxy-section p {
            font-size: 1.2rem;
            line-height: 1.8;
            max-width: 900px;
            margin: 0 auto 30px;
        }
        #payment-portal {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 4;
            background: radial-gradient(circle, #000, #ff00ff);
            text-align: center;
            padding-top: 20%;
        }
        #payment-portal h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3rem;
            color: #00ffcc;
        }
        #payment-portal button {
            padding: 15px 50px;
            background: linear-gradient(90deg, #ff00ff, #00ffcc);
            border: none;
            border-radius: 50px;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
        }
        .scroll-element {
            opacity: 0;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div class="interface" id="interface">
        <div id="chat-container">
            <div id="chat-messages">
                <p class="grok">Bem-vindo à Nave Invest! Sou Grok 3, sua IA guia. Pergunte sobre investimentos e te levarei a uma jornada espacial até o melhor plano para você!</p>
            </div>
            <input type="text" id="chat-input" placeholder="Digite sua dúvida sobre investimentos...">
            <button id="send-btn" onclick="sendMessage()">Enviar</button>
        </div>
    </div>
    <div id="galaxy-section">
        <div class="galaxy-content">
            <h2 id="galaxy-title" class="scroll-element"></h2>
            <p id="galaxy-content" class="scroll-element"></p>
            <button onclick="proceedToPayment()" class="scroll-element">Prosseguir para o Portal de Pagamento</button>
        </div>
    </div>
    <div id="payment-portal">
        <h2>Buraco de Minhoca - Pagamento</h2>
        <p>Finalize sua jornada investindo agora!</p>
        <button onclick="processPayment()">Pagar Agora</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        // Configuração Three.js
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);

        scene.fog = new THREE.FogExp2(0x0a0a23, 0.002);
        const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xffffff, 1, 500);
        pointLight.position.set(50, 50, 50);
        scene.add(pointLight);

        // Estrelas
        const starsGeometry = new THREE.BufferGeometry();
        const starsCount = 20000;
        const positions = new Float32Array(starsCount * 3);
        const sizes = new Float32Array(starsCount);
        const colors = new Float32Array(starsCount * 3);
        for (let i = 0; i < starsCount; i++) {
            positions[i * 3] = (Math.random() - 0.5) * 3000;
            positions[i * 3 + 1] = (Math.random() - 0.5) * 3000;
            positions[i * 3 + 2] = (Math.random() - 0.5) * 3000;
            sizes[i] = Math.random() * 3 + 1;
            colors[i * 3] = Math.random();
            colors[i * 3 + 1] = Math.random();
            colors[i * 3 + 2] = 1;
        }
        starsGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        starsGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
        starsGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        const starsMaterial = new THREE.PointsMaterial({
            sizeAttenuation: true,
            vertexColors: true,
            transparent: true,
            opacity: 0.8
        });
        const stars = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(stars);

        // Nave Espacial
        const shipGroup = new THREE.Group();
        const shipBody = new THREE.Mesh(
            new THREE.ConeGeometry(2, 5, 32),
            new THREE.MeshPhongMaterial({ color: 0x00ffcc, specular: 0xffffff, shininess: 50 })
        );
        shipBody.rotation.x = Math.PI / 2;
        shipGroup.add(shipBody);
        const shipWings = new THREE.Mesh(
            new THREE.BoxGeometry(6, 0.5, 2),
            new THREE.MeshPhongMaterial({ color: 0xff00ff })
        );
        shipWings.position.set(0, -1, 0);
        shipGroup.add(shipWings);
        const shipGlow = new THREE.Mesh(
            new THREE.SphereGeometry(1, 16, 16),
            new THREE.MeshBasicMaterial({ color: 0x00ffcc, transparent: true, opacity: 0.5 })
        );
        shipGlow.position.set(0, 0, -3);
        shipGroup.add(shipGlow);
        shipGroup.position.set(0, 10, 20);
        scene.add(shipGroup);

        camera.position.z = 50;

        // Animações GSAP
        gsap.to(stars.rotation, { y: "+=6.28", duration: 20, ease: "linear", repeat: -1 });
        gsap.to(shipGroup.position, { z: -50, duration: 5, ease: "power2.inOut", repeat: -1, yoyo: true });
        gsap.to(shipGlow.scale, { x: 1.2, y: 1.2, z: 1.2, duration: 1, ease: "sine.inOut", repeat: -1, yoyo: true });

        // Render Loop
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        animate();

        // Chatbot e Lógica de Auto-Programação
        async function sendMessage() {
            const input = document.getElementById('chat-input').value;
            if (!input) return;

            const messages = document.getElementById('chat-messages');
            messages.innerHTML += `<p class="user">Você: ${input}</p>`;

            // Chamada simulada à API Grok 3 (substitua por chamada real via backend)
            const response = await fetch('/api/grok', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: input })
            });
            const data = await response.json();

            messages.innerHTML += `<p class="grok">Grok: ${data.response}</p>`;
            messages.scrollTop = messages.scrollHeight;
            document.getElementById('chat-input').value = '';

            // Identificar perfil e galáxia
            const { galaxy, content } = determineGalaxy(input, data.response);
            if (galaxy) {
                showGalaxy(galaxy, content);
            }
        }

        function determineGalaxy(input, response) {
            // Lógica para identificar perfil e galáxia com base na pergunta
            let galaxy, content;
            if (input.toLowerCase().includes('ações') || response.toLowerCase().includes('ações')) {
                galaxy = 'Galáxia de Ações';
                content = 'Bem-vindo à Galáxia de Ações! Aqui você aprenderá sobre investimentos em bolsa de valores. Ações são uma ótima opção para diversificar sua carteira. Recomendo começar com empresas de tecnologia, como Apple ou Tesla, que têm crescimento estável.';
            } else if (input.toLowerCase().includes('cripto') || response.toLowerCase().includes('cripto')) {
                galaxy = 'Galáxia de Criptomoedas';
                content = 'Você chegou à Galáxia de Criptomoedas! Este é um mercado volátil, mas com alto potencial. Para iniciantes, sugiro investir em Bitcoin ou Ethereum, que são mais consolidados.';
            } else if (input.toLowerCase().includes('esg') || response.toLowerCase().includes('esg')) {
                galaxy = 'Galáxia Sustentável';
                content = 'Bem-vindo à Galáxia Sustentável! Investimentos ESG (Environmental, Social, Governance) focam em sustentabilidade. Empresas como Natura e Unilever são boas escolhas para quem busca impacto positivo.';
            } else {
                galaxy = 'Galáxia Geral';
                content = 'Você está na Galáxia Geral! Parece que você tem dúvidas variadas. Vou te ajudar com um plano diversificado: 50% em ações, 30% em renda fixa e 20% em cripto. O que acha?';
            }
            return { galaxy, content };
        }

        function showGalaxy(galaxy, content) {
            gsap.to('#interface', { opacity: 0, duration: 1, onComplete: () => {
                document.getElementById('interface').style.display = 'none';
                const galaxySection = document.getElementById('galaxy-section');
                galaxySection.style.display = 'block';
                document.getElementById('galaxy-title').textContent = galaxy;
                document.getElementById('galaxy-content').textContent = content;
                gsap.from('#galaxy-section', { opacity: 0, y: 50, duration: 1 });

                // Ativar rolagem
                document.body.style.overflow = 'auto';

                // Animações com ScrollTrigger
                gsap.registerPlugin(ScrollTrigger);
                gsap.from('.scroll-element', {
                    scrollTrigger: {
                        trigger: '.scroll-element',
                        start: 'top 80%',
                        end: 'top 30%',
                        scrub: true
                    },
                    opacity: 0,
                    y: 50,
                    duration: 1,
                    stagger: 0.2
                });

                // Animação 3D baseada no scroll
                gsap.to(shipGroup.position, {
                    scrollTrigger: {
                        trigger: '#galaxy-section',
                        start: 'top top',
                        end: 'bottom bottom',
                        scrub: true
                    },
                    y: -20,
                    ease: 'power2.inOut'
                });
            }});
        }

        function proceedToPayment() {
            gsap.to('#galaxy-section', { opacity: 0, duration: 1, onComplete: () => {
                document.getElementById('galaxy-section').style.display = 'none';
                document.getElementById('payment-portal').style.display = 'block';
                gsap.from('#payment-portal', { opacity: 0, scale: 0.5, duration: 1 });
            }});
        }

        // Integração com Stripe
        const stripe = Stripe('pk_test_sua_chave_publica_aqui');
        function processPayment() {
            stripe.redirectToCheckout({
                lineItems: [{ price: 'price_123', quantity: 1 }],
                mode: 'payment',
                successUrl: 'https://seu-site.com/sucesso',
                cancelUrl: 'https://seu-site.com/cancelado'
            });
        }

        // Redimensionamento
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Enviar mensagem com Enter
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>